---
title: Supervised Learning
output: 
  html_document:
    toc: true
    theme: united
---

# More information

Below is a great tutorial 
Reference: 
https://lgatto.github.io/IntroMachineLearningWithR/supervised-learning.html

This covers these topics:

- Introduction
- Preview
- Model performance
- Cross-validation
- Classification performance
  - Confusion matrix
- Random forest
  - Decision tree
- Data preprocessing
  - Missing values
  - RSME
  - Median imputation

# Decision Trees {.tabset}

Decision trees are a method for predicting an outcome from a set of variables. They are great for creating easily-understandable trees.

## Class Example

This creates a decision tree to predict a textual (class) output.

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(rpart)
library(rpart.plot)

# Load data into a tibble
t <- tibble(
  temp = c(67, 68, 70, 70, 76, 80, 85, 84, 89, 90, 91, 95, 100),
  raining = c('n', 'n', 'n', 'n', 'n','n','n','n','n','n','y', 'n', 'n'),
  camped = c('Camped', 'No', 'No', 'No', 'No', 'No', 'Camped', 'Camped', 'Camped', 'Camped', 'No', 'No', 'No')
)

# Create the model
# https://stat.ethz.ch/R-manual/R-devel/library/rpart/html/rpart.control.html
#   formula: set output to the Species, and choose input fields
#   data: set to our tibble
#   minsplit: the minimum number of observations that must exist in a node in order for a split to be attempted. 
#   minbucket: the minimum number of observations in any terminal
#   method: class, meaning we are predicting a discrete variable
#   
m <- rpart(formula = camped ~ temp + raining,
           data = t,
           minsplit = 8,
           minbucket = 5,
           method = "class")

# Show results of model
rpart.plot(m)

# Create the predicted value and add it to our tibble
predicted <- predict(m, t, type = 'class')
t <- mutate( t, 
             predicted = predicted,
             is_correct = predicted == camped)

# Percentage correct
print(mean(t$is_correct))

# Show a confusion matrix
# Predicted values are in upper case.
table(str_to_upper(t$predicted), t$camped)
```


## Regression Example

This creates a decision tree to predict a numeric output with regression.

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(rpart)
library(rpart.plot)

# Load data into a tibble
t <- tibble(
  temp = c(67, 68, 70, 70, 76, 80, 85, 84, 89, 90, 91, 95, 100),
  raining = c('n', 'n', 'n', 'n', 'n','n','n','n','n','n','y', 'n', 'n'),
  camped = c('Camped', 'No', 'No', 'No', 'No', 'No', 'Camped', 'Camped', 'Camped', 'Camped', 'No', 'No', 'No')
)

# Create the model
# https://stat.ethz.ch/R-manual/R-devel/library/rpart/html/rpart.control.html
#   formula: set output to the Species, and choose input fields
#   data: set to our tibble
#   minsplit: the minimum number of observations that must exist in a node in order for a split to be attempted. 
#   minbucket: the minimum number of observations in any terminal
#   method: class, meaning we are predicting a discrete variable
#   
m <- rpart(formula = temp ~ camped + raining,
           data = t,
           minsplit = 1,
           minbucket = 1,
           method = 'anova')

# Show results of model
rpart.plot(m)

# Create the predicted value and add it to our tibble
predicted <- predict(m, t)
t <- mutate( t, 
             predicted = predicted,
             residual = predicted - temp)

# Residual value
hist(t$residual)
```